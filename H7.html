<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSQL with Progress Bar</title>
    <style>
        #progressContainer {
            width: 100%;
            background-color: #f3f3f3;
            border: 1px solid #ccc;
        }

        #progressBar {
            width: 0%;
            height: 30px;
            background-color: #4caf50;
            text-align: center;
            line-height: 30px;
            color: white;
        }
    </style>
</head>
<body>
    <h1>WebSQL Example with Progress Bar</h1>
    <button onclick="initializeDatabase()">Initialize Database</button>
    <button onclick="getData()">Get Data</button>
    <div id="output"></div>
    <div id="progressContainer">
        <div id="progressBar">0%</div>
    </div>
    <script>
        const dbName = 'myDatabase';
        const dbVersion = '1.0';
        const dbDescription = 'Test DB';
        const dbSize = 2 * 1024 * 1024;
        const sqlFileUrl = 'https://timmyhymn.github.io/Thymn/Thymn.sql';

        function initializeDatabase() {
            fetch(sqlFileUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.text();
                })
                .then(sqlScript => {
                    const db = openDatabase(dbName, dbVersion, dbDescription, dbSize);
                    db.transaction((tx) => {
                        const sqlStatements = sqlScript.split(';').filter(statement => statement.trim() !== '');
                        const totalStatements = sqlStatements.length;
                        let executedStatements = 0;

                        sqlStatements.forEach((statement, index) => {
                            tx.executeSql(statement, [], () => {
                                executedStatements++;
                                const progress = Math.floor((executedStatements / totalStatements) * 100);
                                document.getElementById('progressBar').style.width = progress + '%';
                                document.getElementById('progressBar').innerText = progress + '%';

                                if (executedStatements === totalStatements) {
                                    alert('Database initialization complete!');
                                }
                            }, (tx, error) => {
                                console.error('Error executing SQL statement:', statement, error);
                            });
                        });
                    });
                })
                .catch(error => console.error('Error fetching SQL file:', error));
        }

        function getData() {
            const db = openDatabase(dbName, dbVersion, dbDescription, dbSize);
            db.transaction((tx) => {
                tx.executeSql('SELECT * FROM hymn', [], (tx, results) => {
                    const len = results.rows.length;
                    let output = '<ul>';
                    for (let i = 0; i < len; i++) {
                        const row = results.rows.item(i);
                        output += `<li>Title: ${row.title}, Body: ${row.body}</li>`;
                    }
                    output += '</ul>';
                    document.getElementById('output').innerHTML = output;
                });
            });
        }
    </script>
</body>
</html>
