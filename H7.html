<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSQL Version Check Demo</title>
</head>
<body>
    <h1>WebSQL Version Check Example</h1>
    <button onclick="checkDatabase()">Check Database</button>
    <button id="smallApp" style="display:none;" onclick="runSmallApp()">Run Small App</button>
    <script>
        const dbName = 'myDatabase';
        const dbVersion = '1.0';
        const dbDescription = 'Test DB';
        const dbSize = 2 * 1024 * 1024;

        function checkDatabase() {
            const db = openDatabase(dbName, dbVersion, dbDescription, dbSize, (db) => {
                console.log('Database does not exist, creating...');
                initializeDatabase(db);
            });

            db.transaction((tx) => {
                tx.executeSql('SELECT name FROM sqlite_master WHERE type="table" AND name="Users";', [], (tx, results) => {
                    if (results.rows.length === 0) {
                        console.log('Table does not exist, creating large database...');
                        initializeDatabase(db);
                    } else {
                        console.log('Table exists, running small app...');
                        document.getElementById('smallApp').style.display = 'block';
                    }
                });
            });
        }

        function initializeDatabase(db) {
            db.transaction((tx) => {
                tx.executeSql('CREATE TABLE IF NOT EXISTS Users (user_id UNIQUE, name)', [], (tx, result) => {
                    console.log('Table created');
                    populateLargeDatabase(tx);
                });
            });
        }

        function populateLargeDatabase(tx) {
            for (let i = 1; i <= 1000; i++) {
                tx.executeSql('INSERT INTO Users (user_id, name) VALUES (?, ?)', [i, 'User ' + i]);
            }
            console.log('Large database populated');
        }

        function runSmallApp() {
            alert('Running small app...');
            const db = openDatabase(dbName, dbVersion, dbDescription, dbSize);
            db.transaction((tx) => {
                tx.executeSql('SELECT * FROM Users LIMIT 10', [], (tx, results) => {
                    const len = results.rows.length;
                    for (let i = 0; i < len; i++) {
                        const row = results.rows.item(i);
                        console.log(`User ID: ${row.user_id}, Name: ${row.name}`);
                        alert(`User ID: ${row.user_id}, Name: ${row.name}`);
                    }
                });
            });
        }
    </script>
</body>
</html>
